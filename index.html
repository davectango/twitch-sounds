<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Tango Sound Commands</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* compact floating pill */
    .panel{
      position:fixed;
      top:16px;
      left:16px;
      z-index:999999;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 999px;
      padding: 8px 10px;
      color:#fff;
      display:flex;
      align-items:center;
      gap:10px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .label{
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.2px;
      white-space: nowrap;
      opacity: 0.95;
    }

    .sub{
      font-size: 12px;
      opacity: 0.75;
      white-space: nowrap;
    }

    .text{
      display:flex;
      flex-direction:column;
      line-height: 1.05;
      gap: 2px;
    }

    /* iOS style switch */
    .switch{
      position: relative;
      width: 46px;
      height: 26px;
      border-radius: 999px;
      background: #ff3b30; /* OFF red */
      border: 1px solid rgba(255,255,255,0.18);
      cursor: pointer;
      transition: background 180ms ease;
      flex: 0 0 auto;
    }

    .knob{
      position:absolute;
      top: 2px;
      left: 2px;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.35);
      transition: transform 180ms ease;
    }

    /* ON state */
    .switch.on{
      background: #34c759; /* green */
    }
    .switch.on .knob{
      transform: translateX(20px);
    }

    /* tiny “pulse” when turning on */
    .switch.pulse{
      animation: pulse 260ms ease;
    }
    @keyframes pulse{
      0%{ transform: scale(1); }
      50%{ transform: scale(1.04); }
      100%{ transform: scale(1); }
    }

    /* optional: hide UI while streaming if you want later */
    /* .panel { opacity: 0.9; } */
  </style>
</head>

<body>
  <div class="panel">
    <div class="text">
      <div class="label" id="status">OFF</div>
      <div class="sub" id="hint">click switch once</div>
    </div>

    <div class="switch" id="toggle">
      <div class="knob"></div>
    </div>
  </div>

  <script type="module">
    import tmi from "https://esm.sh/tmi.js@1.8.5";

    const channelName = "tangoplaysdead";

    // ✅ ADD SOUNDS HERE
    const soundMap = {
      "!bruh": "https://www.myinstants.com/media/sounds/movie_1.mp3",
      "!airhorn": "https://www.myinstants.com/media/sounds/airhorn.mp3",
      // "!spin": "PASTE_MP3_LINK_HERE",
    };

    const toggle = document.getElementById("toggle");
    const statusEl = document.getElementById("status");
    const hintEl = document.getElementById("hint");

    let enabled = false;
    let client = null;

    let lastPlay = 0;
    const COOLDOWN_MS = 2000;

    function setUI(state){
      if (!state){
        toggle.classList.remove("on");
        statusEl.textContent = "OFF";
        hintEl.textContent = "click switch once";
      } else {
        toggle.classList.add("on");
        statusEl.textContent = "ON";
        hintEl.textContent = "safe to minimize";
      }
    }

    function pulse(){
      toggle.classList.remove("pulse");
      // reflow trick so animation restarts
      void toggle.offsetWidth;
      toggle.classList.add("pulse");
      setTimeout(()=>toggle.classList.remove("pulse"), 280);
    }

    function playSound(url){
      const now = Date.now();
      if (now - lastPlay < COOLDOWN_MS) return;
      lastPlay = now;

      const audio = new Audio(url);
      audio.volume = 0.9;
      audio.play().catch((e)=>console.log("Audio blocked:", e));
    }

    async function enable(){
      if (enabled) return;
      enabled = true;
      setUI(true);
      pulse();

      if (!client){
        client = new tmi.Client({ channels: [channelName] });
        try{
          await client.connect();
          console.log("Connected to Twitch chat:", channelName);
        } catch(e){
          console.log("Twitch connect failed:", e);
          enabled = false;
          setUI(false);
          return;
        }

        client.on("message", (channel, tags, message, self) => {
          if (self) return;
          if (!enabled) return;

          const cmd = message.trim().split(" ")[0].toLowerCase();
          const url = soundMap[cmd];
          if (url) playSound(url);
        });
      }
    }

    function disable(){
      enabled = false;
      setUI(false);
      pulse();
    }

    toggle.addEventListener("click", async () => {
      if (!enabled) await enable();
      else disable();
    });

    setUI(false);
  </script>
</body>
</html>
