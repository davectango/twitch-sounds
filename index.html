<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tango Sound Commands</title>
<style>
  html, body { margin:0; padding:0; background:#0b0b10; color:#fff; font-family: -apple-system, system-ui, Arial; }
  .wrap { padding: 18px; }
  .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  .pill {
    display:inline-flex; align-items:center; gap:10px;
    padding:10px 14px; border-radius:999px; font-weight:700;
    background:#2a2a35; border:1px solid #3a3a4a;
  }
  .dot { width:12px; height:12px; border-radius:50%; background:#ff3b30; }
  button {
    padding:10px 14px; border-radius:10px; border:0; font-weight:800;
    background:#ff3b30; color:#fff; cursor:pointer;
  }
  button.on { background:#34c759; }
  .small { opacity:0.7; font-size:12px; margin-top:10px; }
</style>
</head>
<body>
<div class="wrap">
  <div class="row">
    <div class="pill">
      <span class="dot" id="dot"></span>
      <span id="armedText">OFF</span>
    </div>

    <div class="pill">
      Chat: <span id="chatText">connecting...</span>
    </div>

    <button id="armBtn">ENABLE SOUND</button>
  </div>

  <div class="small">
    Click ENABLE SOUND once before stream.
  </div>
</div>

<script type="module">
import tmi from "https://esm.sh/tmi.js@1.8.5";

const channelName = "tangoplaysdead";

const soundMap = {
  "!bruh": "https://www.myinstants.com/media/sounds/movie_1.mp3",
  "!horn": "https://www.myinstants.com/media/sounds/airhorn.mp3",
  "!spin": "https://www.soundjay.com/casino/sounds/slot-machine-win-01.mp3"
};

let armed = false;
let lastPlay = 0;
const COOLDOWN_MS = 2000;

const dot = document.getElementById("dot");
const armedText = document.getElementById("armedText");
const armBtn = document.getElementById("armBtn");
const chatText = document.getElementById("chatText");

function setArmed(on) {
  armed = on;
  dot.style.background = on ? "#34c759" : "#ff3b30";
  armedText.textContent = on ? "ON" : "OFF";
  armBtn.classList.toggle("on", on);
  armBtn.textContent = on ? "SOUND ENABLED" : "ENABLE SOUND";
}

armBtn.addEventListener("click", () => setArmed(true));

const client = new tmi.Client({
  channels: [channelName]
});

try {
  await client.connect();
  chatText.textContent = `connected`;
  console.log("Connected to Twitch chat:", channelName);
} catch (e) {
  chatText.textContent = "connect failed";
  console.error(e);
}

function playSound(url) {
  const now = Date.now();
  if (now - lastPlay < COOLDOWN_MS) return;
  lastPlay = now;

  const audio = new Audio(url);
  audio.volume = 0.9;
  audio.play().catch(() => {});
}

client.on("message", (channel, tags, message, self) => {
  if (self) return;

  const cmd = message.trim().toLowerCase();
  const url = soundMap[cmd];
  if (!url) return;
  if (!armed) return;

  playSound(url);
});

setArmed(false);
</script>
</body>
</html>
