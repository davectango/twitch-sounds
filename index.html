<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tango Sound Commands</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: white;
      font-family: Arial, sans-serif;
    }

    .panel {
      padding: 20px;
    }

    .status {
      margin-bottom: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="panel">
  <div class="status" id="statusText">OFF</div>
  <label>
    <input type="checkbox" id="enableToggle">
    Enable Sound Commands
  </label>
  <div>Click once before stream, then you can minimize this window.</div>
</div>

<script type="module">
  import tmi from "https://esm.sh/tmi.js@1.8.5";

  const channelName = "tangoplaysdead";

  const soundMap = {
    "!bruh": "https://www.myinstants.com/media/sounds/movie_1.mp3",
    "!horn": "https://www.myinstants.com/media/sounds/air-horn-club-sample_1.mp3",
    "!spin": "https://www.orangefreesounds.com/wp-content/uploads/2019/08/Slot-machine-jackpot-many-coins-falling.mp3"
  };

  const COOLDOWN_MS = 2000;
  let lastPlay = 0;
  let enabled = false;

  const toggle = document.getElementById("enableToggle");
  const statusText = document.getElementById("statusText");

  toggle.addEventListener("change", () => {
    enabled = toggle.checked;
    statusText.textContent = enabled ? "ON - Connected" : "OFF";
  });

  function playSound(url) {
    const now = Date.now();
    if (now - lastPlay < COOLDOWN_MS) return;
    lastPlay = now;

    const audio = new Audio(url);
    audio.volume = 0.9;
    audio.play().catch(e => console.log("Audio blocked:", e));
  }

  const client = new tmi.Client({
    channels: [channelName]
  });

  await client.connect();
  console.log("Connected to Twitch chat:", channelName);

  client.on("message", (channel, tags, message, self) => {
    if (self) return;
    if (!enabled) return;

    const cmd = message.trim().split(" ")[0].toLowerCase();
    const url = soundMap[cmd];
    if (url) playSound(url);
  });

</script>

</body>
</html>
