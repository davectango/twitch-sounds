<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Tango Sound Commands</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* Small floating UI */
    .panel {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 999999;
      background: rgba(0,0,0,0.65);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 12px;
      padding: 10px 12px;
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      user-select: none;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #ff3b30; /* red by default */
      box-shadow: 0 0 0 2px rgba(255,255,255,0.15) inset;
    }

    .label {
      font-size: 13px;
      opacity: 0.95;
      white-space: nowrap;
    }

    .btn {
      appearance: none;
      border: 0;
      border-radius: 10px;
      padding: 7px 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: rgba(255,255,255,0.14);
      color: #fff;
    }
    .btn:hover { background: rgba(255,255,255,0.20); }
    .btn:active { transform: translateY(1px); }

    .hint {
      font-size: 12px;
      opacity: 0.8;
      margin-left: 6px;
    }
  </style>
</head>

<body>
  <div class="panel">
    <div class="dot" id="dot"></div>
    <div class="label" id="status">OFF</div>
    <button class="btn" id="toggleBtn">ENABLE</button>
    <div class="hint" id="hint">click once before stream</div>
  </div>

  <script type="module">
    import tmi from "https://esm.sh/tmi.js@1.8.5";

    // ✅ your channel name (lowercase)
    const channelName = "tangoplaysdead";

    // ✅ ADD SOUNDS HERE (this is the only section you edit later)
    // Format: "!command": "DIRECT_MP3_LINK",
    const soundMap = {
      "!bruh": "https://www.myinstants.com/media/sounds/movie_1.mp3",
      "!airhorn": "https://www.myinstants.com/media/sounds/airhorn.mp3",
      // Example:
      // "!spin": "https://example.com/slot-lever.mp3",
    };

    const dot = document.getElementById("dot");
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("toggleBtn");
    const hint = document.getElementById("hint");

    let enabled = false;
    let client = null;

    // Cooldown so chat can't spam audio too fast
    let lastPlay = 0;
    const COOLDOWN_MS = 2000;

    function setUI(state) {
      if (!state) {
        dot.style.background = "#ff3b30"; // red
        statusEl.textContent = "OFF";
        btn.textContent = "ENABLE";
        hint.textContent = "click once before stream";
      } else {
        dot.style.background = "#34c759"; // green
        statusEl.textContent = "ON (listening)";
        btn.textContent = "DISABLE";
        hint.textContent = "safe to minimize";
      }
    }

    function playSound(url) {
      const now = Date.now();
      if (now - lastPlay < COOLDOWN_MS) return;
      lastPlay = now;

      const audio = new Audio(url);
      audio.volume = 0.9;
      audio.play().catch((e) => console.log("Audio blocked:", e));
    }

    async function enable() {
      if (enabled) return;
      enabled = true;
      setUI(true);

      // connect to twitch chat
      if (!client) {
        client = new tmi.Client({ channels: [channelName] });
        try {
          await client.connect();
          console.log("Connected to Twitch chat:", channelName);
        } catch (e) {
          console.log("Twitch connect failed:", e);
          // if connect fails, go back off
          enabled = false;
          setUI(false);
          return;
        }

        client.on("message", (channel, tags, message, self) => {
          if (self) return;
          if (!enabled) return;

          const cmd = message.trim().split(" ")[0].toLowerCase();
          const url = soundMap[cmd];
          if (url) playSound(url);
        });
      }
    }

    function disable() {
      enabled = false;
      setUI(false);
    }

    btn.addEventListener("click", async () => {
      if (!enabled) await enable();
      else disable();
    });

    // start in OFF mode
    setUI(false);
  </script>
</body>
</html>
